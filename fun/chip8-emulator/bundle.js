!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=13)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCREEN_WIDTH=64,t.SCREEN_HEIGHT=32,t.MEMORY_SIZE=4096,t.MEMORY_BEGIN=512},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);t.MemoryUI=class{constructor(e){this._propertySheet=e}static getPropertySheetLayout(){let e={view:"datatable",id:"memory-table",columns:[{id:"address",header:"Address",fillspace:2},{id:"hexValue",header:"Value",fillspace:2},{id:"operationName",header:"Operation",fillspace:4}],select:!0,data:[],scheme:{$init:function(e){e.index=this.address}}};for(let t=0;t<n.MEMORY_SIZE;t+=2)e.data.push({address:t.toString(),hexValue:"",operationName:""});return e}getRowIndexFromAddress(e){return parseInt(e)/2}setValue(e){let t=this._propertySheet.getItem(this._propertySheet.getIdByIndex(this.getRowIndexFromAddress(e.address)));t.hexValue=e.hexValue,t.operationName=e.operationName,this._propertySheet.refresh()}setSelectedAddress(e){let t=this.getRowIndexFromAddress(e),i=this._propertySheet.getIdByIndex(t);this._propertySheet.select(i)}scrollToSelection(){let e=this._propertySheet.getSelectedId(),t=this._propertySheet.getIndexById(e)+5;this._propertySheet.showItemByIndex(t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RegistersUI=class{constructor(e,t,i){this._registers1=e,this._registers2=t,this._aloneregisters=i}static getPropertySheetLayout(){return{cols:[{view:"property",id:"registers1",width:300,elements:[{label:"Registers",type:"label"},{label:"V0",type:"text",id:"v0"},{label:"V1",type:"text",id:"v1"},{label:"V2",type:"text",id:"v2"},{label:"V3",type:"text",id:"v3"},{label:"V4",type:"text",id:"v4"},{label:"V5",type:"text",id:"v5"},{label:"V6",type:"text",id:"v6"},{label:"V7",type:"text",id:"v7"}]},{view:"property",id:"registers2",width:300,elements:[{label:"Registers",type:"label"},{label:"V8",type:"text",id:"v8"},{label:"V9",type:"text",id:"v9"},{label:"VA",type:"text",id:"vA"},{label:"VB",type:"text",id:"vB"},{label:"VC",type:"text",id:"vC"},{label:"VD",type:"text",id:"vD"},{label:"VE",type:"text",id:"vE"},{label:"VF",type:"text",id:"vF"}]},{view:"property",id:"alone-registers",width:300,elements:[{label:"Alone registers",type:"label"},{label:"PC",type:"text",id:"pc"},{label:"I",type:"text",id:"i"},{label:"Game Counter",type:"text",id:"gameCounter"},{label:"Sound Counter",type:"text",id:"soundCounter"},{label:"Stack Offset",type:"text",id:"stackOffset"}]}]}}setValues(e){this._registers1.setValues(e,!0),this._registers2.setValues(e,!0),this._aloneregisters.setValues(e,!0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ScreenUI=class{constructor(e){this.SCREEN_WIDTH=64,this.SCREEN_HEIGHT=32,this.SCREEN_UI_WIDTH=800,this.SCREEN_UI_HEIGHT=400,this._canvas=e,this._gl=this._canvas.getContext("webgl",{antialias:!1});var t=this.createShader("attribute vec2 a_position;\n\n            uniform vec2 u_resolution;\n\n            void main() {\n                // pixels to 0.0 -> 2.0\n                vec2 zeroToTwo = (a_position / u_resolution) * 2.0;\n\n                // convert from 0 -> 2 to -1 -> +1 (clipspace)\n                vec2 clipSpace = zeroToTwo - 1.0;\n\n                // Flip 0,0 from bottom left to conventional 2D top left.\n                gl_PointSize = 1.0;\n                gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n            }",this._gl.VERTEX_SHADER),i=this.createShader("precision mediump float;\n\n            uniform vec4 u_color;\n\n            void main() {\n                gl_FragColor = u_color;\n            }",this._gl.FRAGMENT_SHADER),n=this.createGLProgram([t,i]);this._gl.useProgram(n),this._colorLocation=this._gl.getUniformLocation(n,"u_color"),this._positionLocation=this._gl.getAttribLocation(n,"a_position"),this._resolutionLocation=this._gl.getUniformLocation(n,"u_resolution"),this._gl.uniform2f(this._resolutionLocation,this.SCREEN_UI_WIDTH,this.SCREEN_UI_HEIGHT);var r=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,r),this._gl.enableVertexAttribArray(this._positionLocation),this._gl.vertexAttribPointer(this._positionLocation,2,this._gl.FLOAT,!1,0,0),this._gl.clearColor(0,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}createGLProgram(e){for(var t=this._gl.createProgram(),i=0;i<e.length;i+=1)this._gl.attachShader(t,e[i]);if(this._gl.linkProgram(t),!this._gl.getProgramParameter(t,this._gl.LINK_STATUS)){var n=this._gl.getProgramInfoLog(t);return window.console.error("Error in program linking: "+n),this._gl.deleteProgram(t),null}return t}createShader(e,t){let i=this._gl.createShader(t);return this._gl.shaderSource(i,e),this._gl.compileShader(i),i}drawWhitePixel(e,t){this._gl.uniform4f(this._colorLocation,1,1,1,1),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([e+.5,t+.5]),this._gl.STATIC_DRAW),this._gl.drawArrays(this._gl.POINTS,0,1)}drawBlackPixel(e,t){this._gl.uniform4f(this._colorLocation,0,0,0,1),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([e+.5,t+.5]),this._gl.STATIC_DRAW),this._gl.drawArrays(this._gl.POINTS,0,1)}draw(e){for(let t=0;t<this.SCREEN_WIDTH;t++)for(let i=0;i<this.SCREEN_HEIGHT;i++)e[t][i]||this.drawBlackPixel(t,i)}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),s=i(2),o=i(1);t.UIEngine=class{constructor(){this._handlers=new Map,this._runHandlers=[],this._stepHandlers=[],this._stopHandlers=[],this._hexHandlers=[]}on(e,t){this._handlers.has(e)?this._handlers.get(e).push(t):this._handlers.set(e,[t])}emit(e,...t){if(this._handlers.has(e))for(let i of this._handlers.get(e))i(...t)}init(){return n(this,void 0,void 0,function*(){yield this._initWebix(),this._screenUI=new r.ScreenUI(document.getElementById("canvas")),this._registersUI=new s.RegistersUI($$("registers1"),$$("registers2"),$$("alone-registers")),this._memoryUI=new o.MemoryUI($$("memory-table"))})}disable(){this._webixUI.disable()}enable(){this._webixUI.enable()}resetKeyPad(){$$("keypad").unselect()}_initWebix(){let e=this;return new Promise((t,i)=>{webix.ready(function(){e._webixUI=webix.ui({margin:10,padding:0,type:"line",rows:[{view:"toolbar",elements:[{view:"button",value:"Run",width:70,click:e.emit.bind(e,"run")},{view:"button",value:"Step",width:70,click:e.emit.bind(e,"step")},{view:"button",value:"Stop",width:70,click:e.emit.bind(e,"stop")},{view:"label",label:"CHIP8 emulator",align:"center"}]},{cols:[{rows:[{template:"Games",type:"header"},{view:"list",id:"gameList",minWidth:250,template:"#title#",select:!0,on:{onSelectChange:()=>{e.emit("gameSelected",$$("gameList").getSelectedItem().title)}},data:[{id:1,title:"15PUZZLE"},{id:2,title:"BLINKY"},{id:3,title:"BLITZ"},{id:4,title:"BRIX"},{id:5,title:"CONNECT4"},{id:6,title:"GUESS"},{id:7,title:"HIDDEN"},{id:8,title:"INVADERS"},{id:9,title:"KALEID"},{id:10,title:"MAZE"},{id:11,title:"MERLIN"},{id:12,title:"MISSILE"},{id:13,title:"PONG"},{id:14,title:"PONG2"},{id:15,title:"PUZZLE"},{id:16,title:"SYZYGY"},{id:17,title:"TANK"},{id:18,title:"TETRIS"},{id:19,title:"TICTAC"},{id:20,title:"UFO"},{id:21,title:"VBRIX"},{id:22,title:"VERS"},{id:23,title:"WIPEOFF"}]}]},{view:"resizer"},{view:"template",id:"mychart",width:810,height:410,template:'<canvas id="canvas" width="800" height="400"></canvas>'},{view:"resizer"},o.MemoryUI.getPropertySheetLayout()]},{view:"resizer"},{minHeight:300,cols:[s.RegistersUI.getPropertySheetLayout(),{view:"resizer"},{view:"dataview",id:"keypad",xCount:4,yCount:4,select:!0,type:{width:60,height:60},on:{onBeforeSelect:t=>{e.emit("keyPressed",t)},onAfterSelect:t=>{e.emit("keyReleased",t)}},template:"<div class='webix_strong'>#key#</div>",data:[{id:1,key:"1"},{id:2,key:"2"},{id:3,key:"3"},{id:4,key:"4"},{id:5,key:"Q"},{id:6,key:"W"},{id:7,key:"E"},{id:8,key:"R"},{id:9,key:"A"},{id:10,key:"S"},{id:11,key:"D"},{id:12,key:"F"},{id:13,key:"Z"},{id:14,key:"X"},{id:15,key:"C"},{id:16,key:"V"}]}]}]}),t()})})}setOperationName(e){$$("opcode-form").elements.operationName.setValue(e)}setOperationNumber(e){$$("opcode-form").elements.operationNumber.setValue(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ChipInput=class{constructor(){this._keys=[],this._keys.length=16,this._keys.fill(!1)}isPressed(e){return e>=0&&e<16&&this._keys[e]}setPressed(e){e>=0&&e<16&&(this.resetKeys(),this._keys[e]=!0)}setReleased(e){e>=0&&e<16&&this.resetKeys()}resetKeys(){this._keys.fill(!1)}}},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){var i,n,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],u=!1,h=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&_())}function _(){if(!u){var e=a(p);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new d(e,t)),1!==c.length||u||a(_)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,i){(function(t,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4+314e4831
 */var n;n=function(){"use strict";function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,s=void 0,o=void 0,a=function(e,t){d[r]=e,d[r+1]=t,2===(r+=2)&&(o?o(m):v())};var l="undefined"!=typeof window?window:void 0,c=l||{},u=c.MutationObserver||c.WebKitMutationObserver,h="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function _(){var e=setTimeout;return function(){return e(m,1)}}var d=new Array(1e3);function m(){for(var e=0;e<r;e+=2){(0,d[e])(d[e+1]),d[e]=void 0,d[e+1]=void 0}r=0}var f,b,y,g,v=void 0;function E(e,t){var i=this,n=new this.constructor(U);void 0===n[I]&&F(n);var r=i._state;if(r){var s=arguments[r-1];a(function(){return X(r,n,s,i._result)})}else R(i,n,e,t);return n}function N(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(U);return P(t,e),t}h?v=function(){return t.nextTick(m)}:u?(b=0,y=new u(m),g=document.createTextNode(""),y.observe(g,{characterData:!0}),v=function(){g.data=b=++b%2}):p?((f=new MessageChannel).port1.onmessage=m,v=function(){return f.port2.postMessage(0)}):v=void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(m)}:_()}catch(e){return _()}}():_();var I=Math.random().toString(36).substring(2);function U(){}var w=void 0,V=1,S=2,M={error:null};function k(e){try{return e.then}catch(e){return M.error=e,M}}function C(t,i,n){i.constructor===t.constructor&&n===E&&i.constructor.resolve===N?function(e,t){t._state===V?O(e,t._result):t._state===S?T(e,t._result):R(t,void 0,function(t){return P(e,t)},function(t){return T(e,t)})}(t,i):n===M?(T(t,M.error),M.error=null):void 0===n?O(t,i):e(n)?function(e,t,i){a(function(e){var n=!1,r=function(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}(i,t,function(i){n||(n=!0,t!==i?P(e,i):O(e,i))},function(t){n||(n=!0,T(e,t))},e._label);!n&&r&&(n=!0,T(e,r))},e)}(t,i,n):O(t,i)}function P(e,t){var i,n;e===t?T(e,new TypeError("You cannot resolve a promise with itself")):(n=typeof(i=t),null===i||"object"!==n&&"function"!==n?O(e,t):C(e,t,k(t)))}function x(e){e._onerror&&e._onerror(e._result),A(e)}function O(e,t){e._state===w&&(e._result=t,e._state=V,0!==e._subscribers.length&&a(A,e))}function T(e,t){e._state===w&&(e._state=S,e._result=t,a(x,e))}function R(e,t,i,n){var r=e._subscribers,s=r.length;e._onerror=null,r[s]=t,r[s+V]=i,r[s+S]=n,0===s&&e._state&&a(A,e)}function A(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n=void 0,r=void 0,s=e._result,o=0;o<t.length;o+=3)n=t[o],r=t[o+i],n?X(i,n,r,s):r(s);e._subscribers.length=0}}function X(t,i,n,r){var s=e(n),o=void 0,a=void 0,l=void 0,c=void 0;if(s){if((o=function(e,t){try{return e(t)}catch(e){return M.error=e,M}}(n,r))===M?(c=!0,a=o.error,o.error=null):l=!0,i===o)return void T(i,new TypeError("A promises callback cannot return that same promise."))}else o=r,l=!0;i._state!==w||(s&&l?P(i,o):c?T(i,a):t===V?O(i,o):t===S&&T(i,o))}var j=0;function F(e){e[I]=j++,e._state=void 0,e._result=void 0,e._subscribers=[]}var L=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(U),this.promise[I]||F(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&O(this.promise,this._result))):T(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===w&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===N){var r=k(e);if(r===E&&e._state!==w)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===B){var s=new i(U);C(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,i){var n=this.promise;n._state===w&&(this._remaining--,e===S?T(n,i):this._result[t]=i),0===this._remaining&&O(n,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;R(e,void 0,function(e){return i._settledAt(V,t,e)},function(e){return i._settledAt(S,t,e)})},e}();var B=function(){function e(t){this[I]=j++,this._result=this._state=void 0,this._subscribers=[],U!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){P(e,t)},function(t){T(e,t)})}catch(t){T(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this.constructor;return this.then(function(i){return t.resolve(e()).then(function(){return i})},function(i){return t.resolve(e()).then(function(){throw i})})},e}();return B.prototype.then=E,B.all=function(e){return new L(this,e).promise},B.race=function(e){var t=this;return n(e)?new t(function(i,n){for(var r=e.length,s=0;s<r;s++)t.resolve(e[s]).then(i,n)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},B.resolve=N,B.reject=function(e){var t=new this(U);return T(t,e),t},B._setScheduler=function(e){o=e},B._setAsap=function(e){a=e},B._asap=a,B.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=B},B.Promise=B,B},e.exports=n()}).call(this,i(7),i(6))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(8);t.ROMLoader=class{downloadFile(e){return new n.Promise((t,i)=>{var n=new XMLHttpRequest;n.open("GET",`/roms/${e}`,!0),n.responseType="arraybuffer",n.onload=function(e){200!==this.status&&i();var r=n.response;r&&t(r),i()},n.onerror=i,n.send(null)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);t.ChipCPU=class{constructor(e,t,i){this._chipMemory=e,this._uiEngine=t,this._chipInput=i,this.loadOpcodes()}decomposeOpcode(e){return{b4:(61440&e)>>12,b3:(3840&e)>>8,b2:(240&e)>>4,b1:15&e}}executeNextInstruction(){let e=this.getOpcodeFromMemory(),t=this.getOperationNumber(e);-1!=t?this._opcodes[t].jump(this.decomposeOpcode(e)):console.log("Opcode not implemented"),this._chipMemory.advancePC()}getOpcodeFromMemory(){return this.getOpcode(this._chipMemory._memoryView,this._chipMemory._pc)}getOpcode(e,t){return this._chipMemory._memoryView.getUint16(t,!1)}getOperationNumber(e){for(let t=0;t<this._opcodes.length;t++)if((this._opcodes[t].mask&e)==this._opcodes[t].id)return t;return-1}getOperationName(e){let t=this.getOperationNumber(e);return-1===t?"Unknown operation":this._opcodes[t].operationName}loadOpcodes(){let e=this._chipMemory,t=this._chipMemory._V,i=this._chipMemory._memoryView,r=this._chipMemory._stack;this._opcodes=[{mask:65535,id:224,operationName:"00E0 : Clear video memory",jump:({b4:e,b3:t,b2:i,b1:n})=>{this._chipMemory.clearScreen()}},{mask:0,id:4095,operationName:"0NNN : Call CDP1802 subroutine at NNN [Not implemented]",jump:({b4:e,b3:t,b2:i,b1:n})=>{}},{mask:65535,id:238,operationName:"00EE : Return from subroutine",jump:({b4:t,b3:i,b2:n,b1:s})=>{e._stackOffset>0&&(e._stackOffset--,e._pc=r[e._stackOffset])}},{mask:61440,id:4096,operationName:"1NNN : Jump to address NNN",jump:({b4:t,b3:i,b2:n,b1:r})=>{let s=i<<8|n<<4|r;e._pc=s,e._pc-=2}},{mask:61440,id:8192,operationName:"2NNN : Call CHIP-8 subroutine at NNN",jump:({b4:t,b3:i,b2:n,b1:s})=>{let o=i<<8|n<<4|s;r[e._stackOffset]=e._pc,e._stackOffset<15&&e._stackOffset++,e._pc=o,e._pc-=2}},{mask:61440,id:12288,operationName:"3XNN : Skip next instruction if VX == NN",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=r<<4|s;t[n]==o&&(e._pc+=2)}},{mask:61440,id:16384,operationName:"4XNN : Skip next instruction if VX != NN",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=r<<4|s;t[n]!=o&&(e._pc+=2)}},{mask:61455,id:20480,operationName:"5XY0 : Skip next instruction if VX == VY",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=r;t[n]==t[o]&&(e._pc+=2)}},{mask:61440,id:24576,operationName:"6XNN : VX = NN",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=n<<4|r;t[i]=s}},{mask:61440,id:28672,operationName:"7XNN : VX = VX + NN",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n<<4|r;t[s]=t[s]+o&255}},{mask:61455,id:32768,operationName:"8XY0 : VX = VY",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=n;t[i]=t[s]}},{mask:61455,id:32769,operationName:"8XY1 : VX = VX OR VY",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n;t[s]=t[s]|t[o]}},{mask:61455,id:32770,operationName:"8XY2 : VX = VX AND VY",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n;t[s]=t[s]&t[o]}},{mask:61455,id:32771,operationName:"8XY3 : VX = VX XOR VY",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n;t[s]=t[s]^t[o]}},{mask:61455,id:32772,operationName:"8XY4 : VX = VX + VY; VF = 1 if overflow else 0",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n;t[s]=t[s]+t[o],t[s]>255?t[15]=1:t[15]=0,t[s]&=255}},{mask:61455,id:32773,operationName:"8XY5 : VX = VX - VY; VF = 1 if not borrow else 0",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n;t[s]=t[s]-t[o],t[s]>=0?t[15]=1:t[15]=0,t[s]&=255}},{mask:61455,id:32774,operationName:"8XY6 : VF = LSB(VX); VX = VX » 1",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i;t[15]=1&t[s],t[s]=t[s]>>1}},{mask:61455,id:32775,operationName:"8XY7 : VX = VY - VX; VF = 1 if not borrow else 0",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i,o=n;t[s]=t[o]-t[s],t[s]>=0?t[15]=1:t[15]=0,t[s]&=255}},{mask:61455,id:32782,operationName:"8XYE : VF = MSB(VX); VX = VX « 1",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i;t[15]=0&t[s],t[s]=t[s]<<1,t[s]&=255}},{mask:61455,id:36864,operationName:"9XY0 : Skip next instruction if VX != VY",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=r;t[n]!=t[o]&&(e._pc+=2)}},{mask:61440,id:40960,operationName:"ANNN : I = NNN",jump:({b4:t,b3:i,b2:n,b1:r})=>{let s=i<<8|n<<4|r;e._I=s,e._I&=65535}},{mask:61440,id:45056,operationName:"BNNN : Jump to address NNN + V0",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=n<<8|r<<4|s;e._pc=o+t[0],e._pc-=2}},{mask:61440,id:49152,operationName:"CXNN : VX = RND() AND NN",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=n<<4|r;t[i]=Math.round(255*Math.random())&s}},{mask:61440,id:53248,operationName:"DXYN : Draw 8xN sprite at I to VX, VY; VF = 1 if collision else 0",jump:({b4:r,b3:s,b2:o,b1:a})=>{let l=s,c=o,u=a;t[15]=0;for(let r=0;r<u;r++){let s=i.getUint8(e._I+r),o=(t[c]+r)%n.SCREEN_HEIGHT;for(let e=0,i=7;e<8;e++,i--){let r=(t[l]+e)%n.SCREEN_WIDTH;0!=(s&1<<i)&&(this._chipMemory._screenBuffer[r][o]?(this._chipMemory._screenBuffer[r][o]=!1,t[15]=1):this._chipMemory._screenBuffer[r][o]=!0)}}}},{mask:61695,id:57502,operationName:"EX9E : Skip next instruction if key(VX) is pressed",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i;this._chipInput.isPressed(t[s])&&(this._chipMemory._pc+=2)}},{mask:61695,id:57505,operationName:"EXA1 : Skip next instruction if key(VX) is not pressed",jump:({b4:e,b3:i,b2:n,b1:r})=>{let s=i;this._chipInput.isPressed(t[s])||(this._chipMemory._pc+=2)}},{mask:61695,id:61447,operationName:"FX07 : VX = DT",jump:({b4:i,b3:n,b2:r,b1:s})=>{t[n]=e._gameCounter}},{mask:61695,id:61450,operationName:"FX0A : Wait for key press, store key pressed in VX [Not implemented yet]",jump:({b4:e,b3:t,b2:i,b1:n})=>{}},{mask:61695,id:61461,operationName:"FX15 : DT = VX",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=n;e._gameCounter=t[o]}},{mask:61695,id:61464,operationName:"FX18 : ST = VX",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=n;e._soundCounter=t[o]}},{mask:61695,id:61470,operationName:"FX1E : I = I + VX; VF = 1 if I > 0xFFF else 0",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=n;e._I=e._I+t[o],e._I>65535?t[15]=1:t[15]=0,e._I&=65535}},{mask:61695,id:61481,operationName:"FX29 : I = address of 4x5 font character in VX (0..F) (* see note)",jump:({b4:i,b3:n,b2:r,b1:s})=>{let o=n;e._I=5*t[o],e._I&=65535}},{mask:61695,id:61491,operationName:"FX33 : Store BCD representation of VX at I (100), I+1 (10), and I+2 (1); I remains unchanged",jump:({b4:n,b3:r,b2:s,b1:o})=>{i.setUint8(e._I,(t[r]-t[r]%100)/100),i.setUint8(e._I+1,(t[r]-t[r]%10)/10%10),i.setUint8(e._I+2,t[r]-100*i.getUint8(e._I)-10*i.getUint8(e._I+1))}},{mask:61695,id:61525,operationName:"FX55 : Store V0..VX (inclusive) to memory starting at I; I remains unchanged",jump:({b4:n,b3:r,b2:s,b1:o})=>{let a=r;for(let n=0;n<=a;n++)i.setUint8(e._I+n,t[n])}},{mask:61695,id:61541,operationName:"FX65 : Load V0..VX (inclusive) from memory starting at I; I remains unchanged",jump:({b4:n,b3:r,b2:s,b1:o})=>{let a=r;for(let n=0;n<=a;n++)t[n]=i.getUint8(e._I+n)}}]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);t.ChipMemory=class{constructor(){this._V=[],this._stack=[],this._screenBuffer=[],this._memoryBuffer=new ArrayBuffer(n.MEMORY_SIZE),this._memoryView=new DataView(this._memoryBuffer),this.loadFont(),this.resetAllExceptMemory()}decrementCounters(){this._gameCounter>0&&this._gameCounter--,this._soundCounter>0&&this._soundCounter--}loadProgram(e){for(let t=0;t<e.length;t++)this._memoryView.setInt8(n.MEMORY_BEGIN+t,e[t])}clearScreen(){for(let e=0;e<n.SCREEN_WIDTH;e++)for(let t=0;t<n.SCREEN_HEIGHT;t++)this._screenBuffer[e][t]=!1}advancePC(){this._pc+=2,this._pc>=n.MEMORY_SIZE&&(this._pc=n.MEMORY_BEGIN)}resetAllExceptMemory(){this._screenBuffer=[],this._V=[],this._stack=[];for(let e=0;e<n.SCREEN_WIDTH;e++){let e=[];for(let t=0;t<n.SCREEN_HEIGHT;t++)e.push(!1);this._screenBuffer.push(e)}for(let e=0;e<16;e++)this._V.push(0);for(let e=0;e<16;e++)this._stack.push(0);this._pc=n.MEMORY_BEGIN,this._I=0,this._stackOffset=0,this._gameCounter=0,this._soundCounter=0}loadFont(){let e=this._memoryView;e.setUint8(0,240),e.setUint8(1,144),e.setUint8(2,144),e.setUint8(3,144),e.setUint8(4,240),e.setUint8(5,32),e.setUint8(6,96),e.setUint8(7,32),e.setUint8(8,32),e.setUint8(9,112),e.setUint8(10,240),e.setUint8(11,16),e.setUint8(12,240),e.setUint8(13,128),e.setUint8(14,240),e.setUint8(15,240),e.setUint8(16,16),e.setUint8(17,240),e.setUint8(18,16),e.setUint8(19,240),e.setUint8(20,144),e.setUint8(21,144),e.setUint8(22,240),e.setUint8(23,16),e.setUint8(24,16),e.setUint8(25,240),e.setUint8(26,128),e.setUint8(27,240),e.setUint8(28,16),e.setUint8(29,240),e.setUint8(30,240),e.setUint8(31,128),e.setUint8(32,240),e.setUint8(33,144),e.setUint8(34,240),e.setUint8(35,240),e.setUint8(36,16),e.setUint8(37,32),e.setUint8(38,64),e.setUint8(39,64),e.setUint8(40,240),e.setUint8(41,144),e.setUint8(42,240),e.setUint8(43,144),e.setUint8(44,240),e.setUint8(45,240),e.setUint8(46,144),e.setUint8(47,240),e.setUint8(48,16),e.setUint8(49,240),e.setUint8(50,240),e.setUint8(51,144),e.setUint8(52,240),e.setUint8(53,144),e.setUint8(54,144),e.setUint8(55,224),e.setUint8(56,144),e.setUint8(57,224),e.setUint8(58,144),e.setUint8(59,224),e.setUint8(60,240),e.setUint8(61,128),e.setUint8(62,128),e.setUint8(63,128),e.setUint8(64,240),e.setUint8(65,224),e.setUint8(66,144),e.setUint8(67,144),e.setUint8(68,144),e.setUint8(69,224),e.setUint8(70,240),e.setUint8(71,128),e.setUint8(72,240),e.setUint8(73,128),e.setUint8(74,240),e.setUint8(75,240),e.setUint8(76,128),e.setUint8(77,240),e.setUint8(78,128),e.setUint8(79,128)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(11),r=i(10),s=i(9),o=i(0),a=i(5);var l;!function(e){e[e.STOPPED=0]="STOPPED",e[e.RUNNING=1]="RUNNING",e[e.STEPBYSTEP=2]="STEPBYSTEP"}(l||(l={}));t.ChipEngine=class{constructor(){this._state=l.STOPPED,this._cpuClockFactor=2,this._cpuClockCounter=0}init(e){this.resetAll(),this._uiEngine=e,this._uiEngine.on("run",this.onRunEvent.bind(this)),this._uiEngine.on("step",this.onStepEvent.bind(this)),this._uiEngine.on("stop",this.onStopEvent.bind(this)),this._uiEngine.on("hexChanged",this.onHexChangedEvent.bind(this)),this._uiEngine.on("gameSelected",this.onGameSelected.bind(this)),this._uiEngine.on("keyPressed",this.onKeyPressed.bind(this)),this.updateUI()}onRunEvent(){this._state=l.RUNNING,this.runExecutionLoop()}onStepEvent(){this._state=l.STEPBYSTEP,this.runExecutionLoop()}onStopEvent(){this._state=l.STOPPED,this._chipMemory.resetAllExceptMemory(),this.updateUI()}onHexChangedEvent(e,t){this._uiEngine.setOperationName(this._chipCPU.getOperationName(parseInt(e,16))),this._uiEngine.setOperationNumber(this._chipCPU.getOperationNumber(parseInt(e,16)).toString())}onGameSelected(e){this.loadGame(e)}onKeyPressed(e){this._chipInput.setPressed(e)}onKeyReleased(e){this._chipInput.setReleased(e)}loadGame(e){this._uiEngine.disable(),this.resetAll(),this._romLoader.downloadFile(e).then(e=>{this._chipMemory.loadProgram(new Uint8Array(e)),this.updateMemoryUI(),console.log("ROM loaded"),this._uiEngine.enable()}).catch(e=>{console.log("ROM not loaded")})}resetAll(){this._chipMemory=new n.ChipMemory,this._chipInput=new a.ChipInput,this._chipCPU=new r.ChipCPU(this._chipMemory,this._uiEngine,this._chipInput),this._romLoader=new s.ROMLoader,this._state=l.STOPPED}runExecutionLoop(){this._cpuClockCounter>=this._cpuClockFactor&&(this._chipMemory.decrementCounters(),this._uiEngine._screenUI.draw(this._chipMemory._screenBuffer),this._chipInput.resetKeys(),this._uiEngine.resetKeyPad(),this._cpuClockCounter=0),this._chipCPU.executeNextInstruction(),this.updateUI(),this._cpuClockCounter++,this._state===l.RUNNING&&window.requestAnimationFrame(this.runExecutionLoop.bind(this))}updateMemoryUI(){for(let e=0;e<o.MEMORY_BEGIN;e+=2)this._uiEngine._memoryUI.setValue({address:e.toString(),hexValue:this._chipMemory._memoryView.getUint16(e).toString(16),operationName:""});for(let e=o.MEMORY_BEGIN;e<o.MEMORY_SIZE;e+=2){let t=this._chipCPU.getOpcode(this._chipMemory._memoryView,e);this._uiEngine._memoryUI.setValue({address:e.toString(),hexValue:t.toString(16),operationName:this._chipCPU.getOperationName(t)})}}updateUI(){this._uiEngine._registersUI.setValues({pc:this._chipMemory._pc,i:this._chipMemory._I,gameCounter:this._chipMemory._gameCounter,soundCounter:this._chipMemory._soundCounter,stackOffset:this._chipMemory._stackOffset,v0:this._chipMemory._V[0],v1:this._chipMemory._V[1],v2:this._chipMemory._V[2],v3:this._chipMemory._V[3],v4:this._chipMemory._V[4],v5:this._chipMemory._V[5],v6:this._chipMemory._V[6],v7:this._chipMemory._V[7],v8:this._chipMemory._V[8],v9:this._chipMemory._V[9],vA:this._chipMemory._V[10],vB:this._chipMemory._V[11],vC:this._chipMemory._V[12],vD:this._chipMemory._V[13],vE:this._chipMemory._V[14],vF:this._chipMemory._V[15]}),this._uiEngine._memoryUI.setSelectedAddress(this._chipMemory._pc.toString()),this._uiEngine._memoryUI.scrollToSelection()}}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=i(12),s=i(4);let o=new r.ChipEngine,a=new s.UIEngine;try{!function(){n(this,void 0,void 0,function*(){yield a.init(),o.init(a)})}()}catch(e){console.error(e)}}]);